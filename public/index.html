<html>
  <head>
    <title>Static page</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
      var i = -1;
      var titles;
      
      $(function() {
      $('#btn').click(function(e) {
      console.log('clicked');

      $("#citation").text("");
      $("#doi").text("");

      
      var titleData;
      if (i < 0) {
      var multiline = $('#title-area').val();
      titles = multiline.split('\n');

      //var title = $('#title-text').val();
      //var titleData = JSON.stringify([title]);
	      i = 0;
	      }
	      else if (i >= titles.length-1) {
	alert('done');
	return;
	}
	var title = titles[i];
	i++;

	if (!title) {
	alert('empty title');
	return;
	}
	
	titleData = JSON.stringify([title]);	      

	$('#btn').text('Thinking...');
	$('#btn').prop('disabled', true);
	
      $.ajax({
      url:'http://localhost:3000/links',
      type:"POST",
      //data:'["A Bayesian approach to star-galaxy classification"]',
      //data:'["new insight into the strategy for nitrogen metabolism in plant cells"]',
      //"Beta vulgaris: a dearth of antidepressant activity in mice"
      data:titleData,
      contentType:"application/json; charset=utf-8",
      dataType:"json",
      success: function(data) {
      console.log("data from ajax:");
      console.log(data);

      var citation = data.results[0].citation;
      console.log(data.results[0].citation);
      $("#citation").text(citation);

      var doi = data.results[0].doi;
      console.log(doi);
	$("#doi").text(doi);

	var current = $("#doi-area").val();
	if (current.length > 0)
	{
	current += "\n";
	}
	$("#doi-area").val(current + doi);

	$('#btn').text('Click me!');
	$('#btn').prop('disabled', false);
      }
      });
      
      });
      });
    </script>
  </head>
  <body>
    <p>Static page blah</p>
    <!--
    <input type="text" id="title-text" style="width:300px"></input>
    <br>
    -->
    <textarea id="title-area" cols="40" rows="5" wrap="off">A Bayesian approach to star-galaxy classification
new insight into the strategy for nitrogen metabolism in plant cells
Beta vulgaris: a dearth of antidepressant activity in mice
</textarea>
    <button id="btn">Click me!</button>
    <div>Current Citation:</div>
    <div id="citation"></div>
    <div>Current DOI:</div>
    <div id="doi"></div>
    <div>All DOIs:</div>
    <textarea id="doi-area" cols="40" rows="5" readonly></textarea>
  </body>
</html>
